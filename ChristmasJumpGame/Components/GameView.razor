@using Blazor.Extensions.Canvas
@using Blazor.Extensions
@using ChristmasJumpGame.Engine.Abstractions

@foreach (var asset in assets)
{
	if (asset is IImageGameAsset imageGameAsset)
	{
		<img src="@asset.Source" @ref=imageGameAsset.ElementReference style="display:none;" loading="eager" />
	}
}

<div class="gameview" tabindex="0" @attributes="@Attributes"
	 @ref=canvasContainer
	 @onmousemove="OnMouseMove"
	 @onmousedown="OnMouseDown"
	 @onmouseup="OnMouseUp"
	 @onkeydown="OnKeyDown"
	 @onkeyup="OnKeyUp">

	@if (Game is not null)
	{
		<svg viewBox="0 0 @(Game.ViewWidth) @(Game.ViewHeight)">
			<foreignObject x="0" y="0" width="@(Game.ViewWidth)" height="@(Game.ViewHeight)">
				<div style="left: @(-Game.ViewX)px; top:@(-Game.ViewY)px; position: absolute; overflow: visible;">
					<BECanvas @ref=canvas Width="Game.RoomWidth" Height="Game.RoomHeight" />
				</div>
			</foreignObject>
		</svg>

		@* <div style="width: @(Game.ViewWidth)px; height: @(Game.ViewHeight)px; position: relative; overflow: hidden;">
			<div style="left: @(-Game.ViewX)px; top:@(-Game.ViewY)px; position: absolute; overflow: visible;">
				<BECanvas @ref=canvas Width="Game.RoomWidth" Height="Game.RoomHeight" />
			</div>
		</div> *@
	}
</div>

<style>
	.gameview {
		outline: none;
	}

		.gameview svg {
			height: 100%;
		}
</style>